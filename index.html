<!DOCTYPE html>
<html>
<head>
    <title>3D Whack-a-Mole</title>
    <style>
        /* Hide UI elements as needed */
        [data-version-indicator],
        [data-progress-bar],
        [data-instructions],
        .scoreElement,
        .timerElement,
        .instructionsElement,
        #scoreElement,
        #timerElement,
        #instructionsElement {
            display: none !important;
        }
        
        /* Game container */
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            position: relative;
            font-family: Arial, sans-serif;
        }
        
        /* Game canvas container */
        #gameContainer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 20; /* Higher z-index to appear above the overlay */
        }
        
        /* Grass overlay styles */
        #grassOverlay {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: url('https://jjazut1.github.io/image-hosting/grassTexture2d.jpg');
            background-size: cover;
            background-position: bottom center;
            opacity: 0.9;
            pointer-events: none; /* Let clicks pass through to the game */
            z-index: 10; /* Below the game canvas */
            transform-origin: bottom center;
            transform: scale(0.95, 0.95) translate(0px, 0px);
        }
        
        /* Overlay adjustment panel */
        #overlayControls {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: rgba(50, 50, 50, 0.85);
            color: white;
            padding: 20px;
            border-radius: 5px;
            z-index: 100; /* Keep the controls on top of everything */
            width: 600px;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.5);
            display: none;
        }
        
        #overlayControls h2 {
            text-align: center;
            margin-top: 0;
            margin-bottom: 20px;
        }
        
        .control-row {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .control-label {
            width: 150px;
            text-align: right;
            margin-right: 15px;
            font-size: 18px;
        }
        
        .control-value {
            width: 100px;
            text-align: center;
            font-size: 18px;
        }
        
        .control-buttons {
            display: flex;
            flex-grow: 1;
            justify-content: space-around;
        }
        
        .control-button {
            width: 40px;
            height: 40px;
            background-color: #f0f0f0;
            border: none;
            border-radius: 5px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
        }
        
        .control-button:hover {
            background-color: #e0e0e0;
        }
        
        .action-button {
            display: block;
            width: 100%;
            padding: 10px;
            margin-bottom: 10px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            text-align: center;
        }
        
        .action-button:hover {
            background-color: #3e8e41;
        }
        
        #hideControlsText {
            text-align: center;
            margin-top: 10px;
            font-size: 14px;
        }
        
        /* Marker styles for holes */
        .hole-marker {
            position: absolute;
            width: 40px;
            height: 40px;
            background-color: red;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            pointer-events: none;
            z-index: 30; /* Above the game canvas */
            display: none;
        }
    </style>
</head>
<body>
    <!-- Container for the Three.js canvas -->
    <div id="gameContainer"></div>
    
    <!-- Grass overlay div -->
    <div id="grassOverlay"></div>
    
    <!-- Hole markers -->
    <div class="hole-marker" id="marker1" style="left: 20%; top: 65%;">1</div>
    <div class="hole-marker" id="marker2" style="left: 50%; top: 40%;">2</div>
    <div class="hole-marker" id="marker3" style="left: 20%; top: 75%;">3</div>
    <div class="hole-marker" id="marker4" style="left: 80%; top: 75%;">4</div>
    
    <!-- Overlay adjustment controls -->
    <div id="overlayControls">
        <h2>Overlay Adjustment</h2>
        
        <div class="control-row">
            <div class="control-label">X-Scale:</div>
            <div class="control-value" id="xScaleValue">0.95</div>
            <div class="control-buttons">
                <button class="control-button" onclick="adjustSetting('xScale', -0.01)">-</button>
                <button class="control-button" onclick="adjustSetting('xScale', -0.05)">--</button>
                <button class="control-button" onclick="adjustSetting('xScale', 0.05)">++</button>
                <button class="control-button" onclick="adjustSetting('xScale', 0.01)">+</button>
            </div>
        </div>
        
        <div class="control-row">
            <div class="control-label">Y-Scale:</div>
            <div class="control-value" id="yScaleValue">0.95</div>
            <div class="control-buttons">
                <button class="control-button" onclick="adjustSetting('yScale', -0.01)">-</button>
                <button class="control-button" onclick="adjustSetting('yScale', -0.05)">--</button>
                <button class="control-button" onclick="adjustSetting('yScale', 0.05)">++</button>
                <button class="control-button" onclick="adjustSetting('yScale', 0.01)">+</button>
            </div>
        </div>
        
        <div class="control-row">
            <div class="control-label">X Position:</div>
            <div class="control-value" id="xValue">0</div>
            <div class="control-buttons">
                <button class="control-button" onclick="adjustSetting('x', -1)">-</button>
                <button class="control-button" onclick="adjustSetting('x', -5)">--</button>
                <button class="control-button" onclick="adjustSetting('x', 5)">++</button>
                <button class="control-button" onclick="adjustSetting('x', 1)">+</button>
            </div>
        </div>
        
        <div class="control-row">
            <div class="control-label">Y Position:</div>
            <div class="control-value" id="yValue">0</div>
            <div class="control-buttons">
                <button class="control-button" onclick="adjustSetting('y', -1)">-</button>
                <button class="control-button" onclick="adjustSetting('y', -5)">--</button>
                <button class="control-button" onclick="adjustSetting('y', 5)">++</button>
                <button class="control-button" onclick="adjustSetting('y', 1)">+</button>
            </div>
        </div>
        
        <div class="control-row">
            <div class="control-label">Opacity:</div>
            <div class="control-value" id="opacityValue">0.9</div>
            <div class="control-buttons">
                <button class="control-button" onclick="adjustSetting('opacity', -0.05)">-</button>
                <button class="control-button" onclick="adjustSetting('opacity', -0.1)">--</button>
                <button class="control-button" onclick="adjustSetting('opacity', 0.1)">++</button>
                <button class="control-button" onclick="adjustSetting('opacity', 0.05)">+</button>
            </div>
        </div>
        
        <button class="action-button" onclick="tryAlternativeImage()">Try Alternative Image</button>
        <button class="action-button" onclick="toggleOverlay()">Toggle Overlay (T)</button>
        <button class="action-button" onclick="toggleMarkers()">Toggle Markers (D)</button>
        <button class="action-button" onclick="saveSettings()">Save Settings</button>
        
        <div id="hideControlsText">Press A to hide controls</div>
    </div>
    
    <!-- Main game script -->
    <script type="module">
        // Import the main game script
        import * as game from './script.js';
        
        // Redirect the renderer to the container
        window.addEventListener('DOMContentLoaded', () => {
            // This will be used in the script.js file
            window.gameContainer = document.getElementById('gameContainer');
        });
    </script>
    
    <!-- Overlay controller script -->
    <script>
        // Overlay settings
        let overlaySettings = {
            xScale: 0.95,
            yScale: 0.95,
            x: 0,
            y: 0,
            opacity: 0.9,
            visible: true,
            currentImage: 1,
            markersVisible: false
        };
        
        // References to DOM elements
        const grassOverlay = document.getElementById('grassOverlay');
        const overlayControls = document.getElementById('overlayControls');
        const markers = document.querySelectorAll('.hole-marker');
        
        // Initialize from saved settings if available
        function initOverlay() {
            const savedSettings = localStorage.getItem('grassOverlaySettings');
            if (savedSettings) {
                try {
                    const parsed = JSON.parse(savedSettings);
                    
                    // Handle migration from old settings format (with single scale) to new format (with xScale/yScale)
                    if (parsed.scale !== undefined && parsed.xScale === undefined) {
                        parsed.xScale = parsed.scale;
                        parsed.yScale = parsed.scale;
                        delete parsed.scale;
                    }
                    
                    overlaySettings = {...overlaySettings, ...parsed};
                    updateOverlayDisplay();
                    updateControlValues();
                } catch (e) {
                    console.error('Error loading saved settings:', e);
                }
            }
        }
        
        // Apply current settings to the overlay
        function updateOverlayDisplay() {
            if (overlaySettings.visible) {
                grassOverlay.style.display = 'block';
                grassOverlay.style.opacity = overlaySettings.opacity;
                grassOverlay.style.transform = `scale(${overlaySettings.xScale}, ${overlaySettings.yScale}) translate(${overlaySettings.x}px, ${overlaySettings.y}px)`;
            } else {
                grassOverlay.style.display = 'none';
            }
            
            // Update marker visibility
            markers.forEach(marker => {
                marker.style.display = overlaySettings.markersVisible ? 'flex' : 'none';
            });
        }
        
        // Update the control panel values
        function updateControlValues() {
            document.getElementById('xScaleValue').textContent = overlaySettings.xScale.toFixed(2);
            document.getElementById('yScaleValue').textContent = overlaySettings.yScale.toFixed(2);
            document.getElementById('xValue').textContent = overlaySettings.x;
            document.getElementById('yValue').textContent = overlaySettings.y;
            document.getElementById('opacityValue').textContent = overlaySettings.opacity.toFixed(1);
        }
        
        // Adjust a setting by the specified amount
        function adjustSetting(setting, amount) {
            switch(setting) {
                case 'xScale':
                    overlaySettings.xScale = Math.max(0.1, Math.min(3.0, overlaySettings.xScale + amount));
                    break;
                case 'yScale':
                    overlaySettings.yScale = Math.max(0.1, Math.min(3.0, overlaySettings.yScale + amount));
                    break;
                case 'x':
                    overlaySettings.x += amount;
                    break;
                case 'y':
                    overlaySettings.y += amount;
                    break;
                case 'opacity':
                    overlaySettings.opacity = Math.max(0, Math.min(1, overlaySettings.opacity + amount));
                    break;
            }
            
            updateOverlayDisplay();
            updateControlValues();
        }
        
        // Toggle overlay visibility
        function toggleOverlay() {
            overlaySettings.visible = !overlaySettings.visible;
            updateOverlayDisplay();
        }
        
        // Toggle markers visibility
        function toggleMarkers() {
            overlaySettings.markersVisible = !overlaySettings.markersVisible;
            updateOverlayDisplay();
        }
        
        // Try alternative image
        function tryAlternativeImage() {
            overlaySettings.currentImage = overlaySettings.currentImage === 1 ? 2 : 1;
            
            // Switch between images
            if (overlaySettings.currentImage === 1) {
                grassOverlay.style.backgroundImage = "url('https://jjazut1.github.io/image-hosting/grassTexture2d.jpg')";
            } else {
                // You can replace this with an alternative URL
                grassOverlay.style.backgroundImage = "url('https://jjazut1.github.io/image-hosting/grassTexture2d-alt.jpg')";
            }
        }
        
        // Save current settings to localStorage
        function saveSettings() {
            try {
                localStorage.setItem('grassOverlaySettings', JSON.stringify(overlaySettings));
                alert('Settings saved!');
            } catch (e) {
                console.error('Error saving settings:', e);
                alert('Error saving settings. See console for details.');
            }
        }
        
        // Toggle controls visibility with 'A' key
        function toggleControls() {
            overlayControls.style.display = overlayControls.style.display === 'none' ? 'block' : 'none';
        }
        
        // Keyboard shortcuts
        document.addEventListener('keydown', (event) => {
            switch(event.key.toLowerCase()) {
                case 'a':
                    toggleControls();
                    break;
                case 't':
                    toggleOverlay();
                    break;
                case 'd':
                    toggleMarkers();
                    break;
            }
        });
        
        // Initialize overlay
        window.addEventListener('DOMContentLoaded', () => {
            initOverlay();
            // Show controls by default
            overlayControls.style.display = 'block';
        });
    </script>
</body>
</html>
